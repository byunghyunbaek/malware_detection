import os
import glob
import random
from malware.feature.window_entropy_rating import WindowEntropyRating


MAX_NUMBER_OF_FEATURES = 3000
level = 1


if __name__ == '__main__':
    LABEL_MALWARE = 0
    LABEL_BENIGN = 1

    malware_dir_path = '~/Data/SSecurityData/dataset_all/exe/malware'
    benign_dir_path = '~/Data/SSecurityData/dataset_all/exe/benign'
    feature_file_path = '~/Data/entropy_feature.spa'

    malware_files = glob.glob(os.path.join(malware_dir_path, '*'))
    benign_files = glob.glob(os.path.join(benign_dir_path, '*'))

    malware_window_entropy_ratings = list()

    random.shuffle(malware_files)
    count = 0
    for file_path in malware_files:
        if count > 3000:
            break

        if count % 100 == 0:
            print('DEBUG-> Extract malware feature. {0}'.format(count))

        malware_window_entropy_ratings.append(WindowEntropyRating(level=level, file_path=file_path))

        count += 1

    benign_window_entropy_ratings = list()

    random.shuffle(benign_files)
    count = 0
    for file_path in benign_files:
        if count > 3000:
            break

        if count % 100 == 0:
            print('DEBUG-> Extract benign feature. {0}'.format(count))

        benign_window_entropy_ratings.append(WindowEntropyRating(level=level, file_path=file_path))

        count += 1

    with open(feature_file_path, 'w') as file_descriptor:
        for window_entropy_rating in malware_window_entropy_ratings:
            file_descriptor.write(window_entropy_rating.to_string(LABEL_MALWARE))
            file_descriptor.write('\n')

        for window_entropy_rating in benign_window_entropy_ratings:
            file_descriptor.write(window_entropy_rating.to_string(LABEL_BENIGN))
            file_descriptor.write('\n')


