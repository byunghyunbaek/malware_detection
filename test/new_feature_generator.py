import os
import glob
import random

LABEL_OF_MALWARE = 0
LABEL_OF_BENIGN = 1


if __name__ == '__main__':
    rating_level = 6

    FEATURE_FILE_PATH = r'D:\malware_feature\feature\malwares_level{0}.spa'.format(rating_level)
    # MALWARE_DIR_PATH = r'D:\malware_feature\MS_data\level_{0}'.format(rating_level)
    BENIGN_DIR_PATH = r'D:\malware_feature\Malwares\benign\benign_level_{0}'.format(rating_level)

    ADWARE_DIR_PATH = r'D:\malware_feature\Malwares\adware\adware_level_{0}'.format(rating_level)
    DOWNLOADER_DIR_PATH = r'D:\malware_feature\Malwares\downloader\downloader_level_{0}'.format(rating_level)
    HIDER_DIR_PATH = r'D:\malware_feature\Malwares\hider\hider_level_{0}'.format(rating_level)
    PACKED_DIR_PATH = r'D:\malware_feature\Malwares\packed\packed_level_{0}'.format(rating_level)
    REMOTECON_DIR_PATH = r'D:\malware_feature\Malwares\remotecon\remotecon_level_{0}'.format(rating_level)
    REPLICATOR_DIR_PATH = r'D:\malware_feature\Malwares\replicator\replicator_level_{0}'.format(rating_level)
    TROJWARE_DIR_PATH = r'D:\malware_feature\Malwares\trojware\trojware_level_{0}'.format(rating_level)
    WARNING_DIR_PATH = r'D:\malware_feature\Malwares\warning\warn_level_{0}'.format(rating_level)

    adware_file_paths = glob.glob(os.path.join(ADWARE_DIR_PATH, '*'))
    downloader_file_paths = glob.glob(os.path.join(DOWNLOADER_DIR_PATH, '*'))
    hider_file_paths = glob.glob(os.path.join(HIDER_DIR_PATH, '*'))
    packed_file_paths = glob.glob(os.path.join(PACKED_DIR_PATH, '*'))
    remotecon_file_paths = glob.glob(os.path.join(REMOTECON_DIR_PATH, '*'))
    replicator_file_paths = glob.glob(os.path.join(REPLICATOR_DIR_PATH, '*'))
    trojware_file_paths = glob.glob(os.path.join(TROJWARE_DIR_PATH, '*'))
    warning_file_paths = glob.glob(os.path.join(WARNING_DIR_PATH, '*'))

    malware_file_paths = adware_file_paths + downloader_file_paths + hider_file_paths + packed_file_paths \
                         + remotecon_file_paths + replicator_file_paths + trojware_file_paths + warning_file_paths

    print('Number of files: {0}'.format(len(malware_file_paths)))

    features = list()
    for file_path in malware_file_paths:
        with open(file_path, 'r') as file_descriptor:
            lines = file_descriptor.readlines()

        if len(lines) != 1:
            raise Exception('Invalid malware feature format')

        features.append('{0} {1}'.format(LABEL_OF_MALWARE, lines[0].strip()))

    benign_file_paths = glob.glob(os.path.join(BENIGN_DIR_PATH, '*'))
    for file_path in benign_file_paths:
        with open(file_path, 'r') as file_descriptor:
            lines = file_descriptor.readlines()

        if len(lines) != 1:
            raise Exception('Invalid benign feature format')

        features.append('{0} {1}'.format(LABEL_OF_BENIGN, lines[0].strip()))

    with open(FEATURE_FILE_PATH, 'w') as file_descriptor:
        for feature in features:
            file_descriptor.write(feature)
            file_descriptor.write('\n')
