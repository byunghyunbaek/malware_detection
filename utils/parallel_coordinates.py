import os
import glob

import pandas as pd
import matplotlib.pyplot as plt
from pandas.plotting import parallel_coordinates


def _load_histogram(file_path):
    with open(file_path, 'r') as file_descriptor:
        lines = file_descriptor.readlines()

    entropy_histograms = list()

    for line in lines:
        line = line.strip()
        entropy_histogram = list()

        values = line.split(' ')
        for value in values:
            entropy_histogram.append(float(value.split(':')[1]))

        entropy_histograms.append(entropy_histogram)

    return entropy_histograms


if __name__ == '__main__':
    HISTOGRAM_ROOT_DIR_PATH = r'C:\Users\BAEK\Desktop\research\DataHistogram\data\histogram'
    HISTOGRAM_TYPES = ['ADWARE', 'BENIGN', 'DOWNLOADER', 'PACKED', 'TROJAN', 'WORM']

    columns = list()
    for index in range(0, 256):
        columns.append(str(index))

    columns.append('type')

    data_frame = pd.DataFrame(columns=columns)

    for histogram_type in HISTOGRAM_TYPES:
        dir_path = os.path.join(HISTOGRAM_ROOT_DIR_PATH, histogram_type)
        file_paths = glob.glob(os.path.join(dir_path, '*'))

        for file_path in file_paths:
            entropy_histogram = _load_histogram(file_path)[0]
            entropy_histogram.append(histogram_type)

            data_frame = data_frame.append(pd.DataFrame(data=[entropy_histogram], columns=columns))

    parallel_coordinates(data_frame, 'type', colormap=plt.get_cmap("Set2"))

    plt.savefig(r'C:\Users\BAEK\Desktop\research\DataHistogram\performance\parallel_coordinate.PNG')
