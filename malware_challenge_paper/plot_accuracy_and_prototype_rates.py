import os

import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns
import itertools


def plot_accuracy_and_prototype_rates(accuracies, prototype_rates, fig_path):
    bins = ['0.5', '0.1', '0.05', '0.01', '0.005', '0.001', '0.0005', '0.0001', '0.00005']
    bar_width = 0.25
    opacity = 0.8
    line_markers = ['D', 'v', '^', 'o']
    hatches = ['/////', '//', '\\\\\\\\', '\\\\']
    line_styles = ['dashdot', 'dotted', 'dashed', (0, (3, 1, 1, 1, 1, 1))]
    indexes = np.arange(len(bins))

    fig, ax1 = plt.subplots(figsize=(6, 4))

    ax1_lns = ax1.plot(indexes, accuracies, marker=line_markers[3], markeredgecolor=(0.0, 0.0, 0.0), markersize=6,
                       markeredgewidth=0.5, linestyle=line_styles[2], color=(0.65, 0.65, 0.65), label='Accuracy')

    ax1.set_xlabel(r'$\theta$', fontsize=9)
    ax1.set_ylabel('Accuracy(%)', fontsize=9)
    ax1.set_ylim(45, 100)

    ax1.tick_params(axis='both', labelsize=7)

    ax2 = ax1.twinx()
    ax2_lns = ax2.bar(indexes, prototype_rates, alpha=opacity, color=(0.9, 0.9, 0.9),
                       width=bar_width, hatch=hatches[2], label='Prototype rate', edgecolor='black', linewidth=1)

    ax2.set_ylabel('Prototype rate(%)', fontsize=9)
    ax1.tick_params(axis='both', labelsize=7)

    legend = ax1_lns + [ax2_lns]
    labels = [l.get_label() for l in legend]

    plt.grid(True, 'major', 'y', ls='--', lw=.1, c='k', alpha=1)
    plt.tick_params(labelsize=7)
    plt.xticks(indexes, bins)
    plt.legend(legend, labels, loc='best', fontsize=8)
    plt.tight_layout()

    plt.savefig(fig_path)
    # plt.show()


if __name__ == '__main__':
    FIG_DIR_PATH = r'D:\python_workspace\workspace\prototype_selection'

    L1_accuracy = [65.98, 85.38, 87.67, 95.78, 97.69, 98.07, 97.95, 98.12, 97.87]
    L1_prototype_rate = [09.53, 20.78, 25.11, 41.16, 51.72, 80.47, 93.70, 99.10, 99.57]
    plot_accuracy_and_prototype_rates(L1_accuracy, L1_prototype_rate, os.path.join(FIG_DIR_PATH, 'L1_accuracy_and_prototype_rate.png'))

    L2_accuracy = [54.38, 76.49, 86.71, 97.42, 98.00, 98.21, 98.27, 98.23, 98.21]
    L2_prototype_rate = [11.70, 23.00, 28.75, 47.58, 62.89, 93.01, 96.90, 99.54, 99.71]
    plot_accuracy_and_prototype_rates(L2_accuracy, L2_prototype_rate, os.path.join(FIG_DIR_PATH, 'L2_accuracy_and_prototype_rate.png'))

    L4_accuracy = [69.05, 68.46, 94.68, 98.35, 98.64, 98.59, 98.62, 98.64, 98.72]
    L4_prototype_rate = [15.13, 29.89, 36.87, 66.09, 78.45, 98.11, 99.10, 99.78, 99.83]
    plot_accuracy_and_prototype_rates(L4_accuracy, L4_prototype_rate, os.path.join(FIG_DIR_PATH, 'L4_accuracy_and_prototype_rate.png'))

    L6_accuracy = [69.29, 76.84, 95.95, 98.73, 98.73, 98.75, 98.73, 98.88, 98.79]
    L6_prototype_rate = [16.94, 30.50, 37.58, 69.94, 87.56, 98.70, 99.38, 99.81, 99.85]
    plot_accuracy_and_prototype_rates(L6_accuracy, L6_prototype_rate, os.path.join(FIG_DIR_PATH, 'L6_accuracy_and_prototype_rate.png'))